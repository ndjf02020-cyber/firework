<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firework - smallbrandings</title>
    <link href="https://fonts.googleapis.com/css2?family=Aboreto&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Aboreto', cursive; cursor: crosshair; color: #fff; }
        canvas { display: block; }
        #intro-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; justify-content: center; align-items: center; z-index: 1000; cursor: pointer; transition: opacity 1s; }
        #intro-layer h1 { font-size: 4rem; font-weight: 400; letter-spacing: 5px; margin: 0; animation: pulse 2.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        .ui-container { position: fixed; top: 20px; left: 20px; background: rgba(255, 255, 255, 0.08); padding: 15px 20px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); display: flex; flex-direction: column; gap: 10px; z-index: 100; opacity: 0; transition: opacity 1s; pointer-events: none; }
        .ui-container.visible { opacity: 1; pointer-events: auto; }
        .bg-control { position: fixed; top: 20px; right: 20px; background: rgba(255, 255, 255, 0.08); padding: 15px; border-radius: 15px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); z-index: 101; opacity: 0; transition: opacity 1s; }
        .bg-control.visible { opacity: 1; }
        .bg-control label { display: block; font-size: 10px; margin-bottom: 5px; text-align: right; opacity: 0.7; }
        #bg-slider { width: 120px; cursor: pointer; }
        .controls { display: flex; align-items: center; gap: 10px; }
        select { padding: 4px; border-radius: 5px; background: #111; color: #fff; border: 1px solid #444; font-size: 11px; }
        .random-mode { font-size: 11px; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .footer { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 10px; letter-spacing: 1.5px; opacity: 0.4; z-index: 50; pointer-events: none; text-transform: uppercase; }
    </style>
</head>
<body>

    <div id="intro-layer"><h1>FIREWORK</h1></div>
    <div class="ui-container" id="main-ui">
        <div class="controls">
            <select class="color-picker" id="c1"></select>
            <select class="color-picker" id="c2"></select>
            <select class="color-picker" id="c3"></select>
            <label class="random-mode"><input type="checkbox" id="random-check"> RANDOM COLOR</label>
        </div>
    </div>
    <div class="bg-control" id="bg-ui">
        <label>SKY HUE</label>
        <input type="range" id="bg-slider" min="0" max="40" value="0">
    </div>
    <div class="footer">made by smallbrandings</div>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const intro = document.getElementById('intro-layer');
        const uiElements = [document.getElementById('main-ui'), document.getElementById('bg-ui')];
        const randomCheck = document.getElementById('random-check');
        const bgSlider = document.getElementById('bg-slider');

        const colorPalette = [
            { name: "GOLD", hue: 45, sat: 100 }, { name: "RED", hue: 0, sat: 100 },
            { name: "PINK", hue: 330, sat: 100 }, { name: "PURPLE", hue: 270, sat: 80 },
            { name: "BLUE", hue: 210, sat: 100 }, { name: "EMERALD", hue: 150, sat: 100 },
            { name: "WHITE", hue: 0, sat: 0 }, { name: "ORANGE", hue: 30, sat: 100 },
            { name: "LIME", hue: 90, sat: 100 }
        ];

        intro.addEventListener('click', () => {
            intro.style.opacity = '0';
            setTimeout(() => { intro.style.display = 'none'; uiElements.forEach(el => el.classList.add('visible')); }, 1000);
        });

        bgSlider.addEventListener('input', (e) => { document.body.style.backgroundColor = `rgb(0, ${e.target.value/2}, ${e.target.value})`; });

        const selects = document.querySelectorAll('.color-picker');
        selects.forEach((s, idx) => {
            colorPalette.forEach((c, i) => {
                const opt = document.createElement('option');
                opt.value = i; opt.textContent = c.name;
                if(idx === 0 && c.name === "GOLD") opt.selected = true;
                if(idx === 1 && c.name === "RED") opt.selected = true;
                if(idx === 2 && c.name === "WHITE") opt.selected = true;
                s.appendChild(opt);
            });
        });

        function getColors() {
            if (randomCheck.checked) return [1, 2, 3].map(() => colorPalette[Math.floor(Math.random() * colorPalette.length)]);
            return Array.from(selects).map(s => colorPalette[s.value]);
        }

        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        let fireworks = [];
        let particles = [];

        class Firework {
            constructor(sx, sy, tx, ty, colorSet) {
                this.x = sx; this.y = sy; this.tx = tx; this.ty = ty;
                this.colorSet = colorSet;
                this.launchSpeed = 5.2; 
                this.vy = -this.launchSpeed;
            }
            update() { this.y += this.vy; return (this.y <= this.ty); }
            draw() {
                ctx.fillStyle = "rgba(255, 255, 240, 1)";
                ctx.beginPath(); ctx.arc(this.x, this.y, 1.5, 0, Math.PI * 2); ctx.fill();
            }
        }

        class Particle {
            constructor(x, y, color, zScale) {
                this.x = x; this.y = y;
                const angle = Math.random() * Math.PI * 2;
                
                // 도넛 현상 방지: 0부터 최대치까지 불규칙하게 내부를 채움
                const force = Math.random() * (12 * zScale) + 0.5;
                
                this.vx = Math.cos(angle) * force;
                this.vy = Math.sin(angle) * force;
                
                // 불규칙한 마찰로 입자 간 거리 분산
                this.friction = 0.88 + (Math.random() * 0.08); 
                this.gravity = (0.01 + Math.random() * 0.02) * zScale; 
                
                this.alpha = 1;
                this.decay = (Math.random() * 0.003 + 0.004) / zScale; 
                
                // 색상의 명도를 낮게 설정하여 중심부 뭉침 시 화이트아웃 방지
                const lightness = color.name === "WHITE" ? 90 : 45 + (Math.random() * 15);
                this.color = `hsla(${color.hue}, ${color.sat}%, ${lightness}%, `;
                this.size = (Math.random() * 0.5 + 0.15) * zScale; 
            }
            update() {
                this.vx *= this.friction; this.vy *= this.friction; this.vy += this.gravity;
                this.x += this.vx; this.y += this.vy; this.alpha -= this.decay;
                return (this.alpha <= 0);
            }
            draw() {
                ctx.fillStyle = this.color + this.alpha + ")";
                ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
            }
        }

        function createParticles(x, y, colorSet) {
            const zScale = Math.random() * 1.8 + 0.5;
            let count = Math.floor(3500 * zScale);
            // 메모리 관리
            if (particles.length > 25000) count *= 0.4; 
            
            for (let i = 0; i < count; i++) {
                particles.push(new Particle(x, y, colorSet[Math.floor(Math.random() * colorSet.length)], zScale));
            }
        }

        function loop() {
            requestAnimationFrame(loop);
            ctx.globalCompositeOperation = 'destination-out';
            ctx.fillStyle = 'rgba(0, 0, 0, 0.25)'; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.globalCompositeOperation = 'lighter';

            for (let i = fireworks.length - 1; i >= 0; i--) {
                const f = fireworks[i];
                if (f.update()) { createParticles(f.tx, f.ty, f.colorSet); fireworks.splice(i, 1); } 
                else { f.draw(); }
            }

            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                if (p.update()) { particles.splice(i, 1); } 
                else { p.draw(); }
            }
        }

        window.addEventListener('mousedown', (e) => {
            if (e.target.closest('.ui-container') || e.target.closest('.bg-control') || intro.style.display !== 'none') return;
            fireworks.push(new Firework(e.clientX, canvas.height, e.clientX, e.clientY, getColors()));
        });
        loop();
    </script>
</body>
</html>