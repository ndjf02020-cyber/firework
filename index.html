<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firework 3D Orbit - smallbrandings</title>
    <link href="https://fonts.googleapis.com/css2?family=Aboreto&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Aboreto', cursive; cursor: crosshair; color: #fff; user-select: none; }
        canvas { display: block; }
        
        /* 이전 UI 스타일 유지 */
        #intro-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; cursor: pointer; transition: opacity 1s; }
        #intro-layer h1 { font-size: 60px; letter-spacing: 12px; margin: 0; animation: pulse 2.5s infinite; }
        #intro-layer p { font-size: 14px; margin-top: 20px; opacity: 0.5; }
        @keyframes pulse { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }

        .top-right-ui { position: fixed; top: 20px; right: 20px; display: flex; flex-direction: column; align-items: flex-end; gap: 8px; z-index: 101; opacity: 0; transition: opacity 1s; pointer-events: none; }
        .top-right-ui.visible { opacity: 1; pointer-events: auto; }
        .control-panel { background: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); display: flex; flex-direction: column; gap: 8px; }
        .control-group { display: flex; flex-direction: column; align-items: flex-end; }
        .control-group label { font-size: 8px; margin-bottom: 2px; opacity: 0.6; }
        input[type="range"] { width: 100px; cursor: pointer; accent-color: #fff; }
        
        .view-info { position: fixed; bottom: 20px; left: 20px; font-size: 10px; opacity: 0.4; pointer-events: none; }
    </style>
</head>
<body>

<div id="intro-layer">
    <h1>FIREWORK 3D</h1>
    <p>드래그하여 공간을 회전하고, 클릭하여 폭죽을 쏘세요.</p>
</div>

<div class="top-right-ui" id="right-ui">
    <div class="control-panel">
        <div class="control-group">
            <label>SIZE</label>
            <input type="range" id="size-slider" min="2" max="20" value="10">
        </div>
        <div class="control-group">
            <label>DENSITY</label>
            <input type="range" id="density-slider" min="10" max="100" value="40">
        </div>
    </div>
</div>

<div class="view-info">DRAG TO ROTATE VIEW</div>
<canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const intro = document.getElementById('intro-layer');
    const rightUi = document.getElementById('right-ui');
    const sizeSlider = document.getElementById('size-slider');
    const densitySlider = document.getElementById('density-slider');

    let particles = [];
    let angleX = 0, angleY = 0; // 카메라 회전 각도
    let isDragging = false;
    let lastMouseX, lastMouseY;

    // 초기 설정
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    intro.addEventListener('click', () => {
        intro.style.opacity = '0';
        setTimeout(() => { intro.style.display = 'none'; rightUi.classList.add('visible'); }, 1000);
    });

    // 드래그 로직 (시점 변경)
    window.addEventListener('mousedown', (e) => {
        if(e.target.closest('.top-right-ui')) return;
        isDragging = true;
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
    });

    window.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        let dx = e.clientX - lastMouseX;
        let dy = e.clientY - lastMouseY;
        
        angleY += dx * 0.01; // 좌우 회전
        angleX += dy * 0.01; // 상하 회전
        
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
    });

    window.addEventListener('mouseup', () => isDragging = false);

    // 클릭 시 폭죽 발사 (중앙 기준 3D 공간에 생성)
    window.addEventListener('click', (e) => {
        if (e.target.closest('.top-right-ui') || intro.style.display !== 'none' || Math.abs(lastMouseX - e.clientX) > 5) return;
        createExplosion(e.clientX - canvas.width/2, e.clientY - canvas.height/2);
    });

    class Particle {
        constructor(x, y, z, color) {
            this.x = x; this.y = y; this.z = z; // 3D 좌표
            const speed = Math.random() * 8 + 1;
            const theta = Math.random() * Math.PI * 2;
            const phi = Math.random() * Math.PI;

            // 구형(Spherical) 폭발 좌표 계산
            this.vx = Math.sin(phi) * Math.cos(theta) * speed;
            this.vy = Math.sin(phi) * Math.sin(theta) * speed;
            this.vz = Math.cos(phi) * speed;

            this.friction = 0.95;
            this.gravity = 0.15;
            this.alpha = 1;
            this.decay = Math.random() * 0.015 + 0.005;
            this.color = color;
            this.size = (sizeSlider.value / 10) * (Math.random() * 1.2 + 0.5);
        }

        update() {
            this.vx *= this.friction; this.vy *= this.friction; this.vz *= this.friction;
            this.vy += this.gravity;
            this.x += this.vx; this.y += this.vy; this.z += this.vz;
            this.alpha -= this.decay;
        }

        draw() {
            // 3D 회전 변환 (Y축 회전)
            let x1 = this.x * Math.cos(angleY) + this.z * Math.sin(angleY);
            let z1 = this.z * Math.cos(angleY) - this.x * Math.sin(angleY);
            
            // 3D 회전 변환 (X축 회전)
            let y2 = this.y * Math.cos(angleX) - z1 * Math.sin(angleX);
            let z2 = z1 * Math.cos(angleX) + this.y * Math.sin(angleX);

            // 원근법 적용 (Perspective)
            const fov = 600; 
            const scale = fov / (fov + z2);
            const px = x1 * scale + canvas.width / 2;
            const py = y2 * scale + canvas.height / 2;

            if (this.alpha > 0) {
                ctx.fillStyle = `hsla(${this.color}, 100%, 70%, ${this.alpha})`;
                ctx.beginPath();
                ctx.arc(px, py, this.size * scale, 0, Math.PI * 2);
                ctx.fill();
            }
        }
    }

    function createExplosion(x, y) {
        const color = Math.random() * 360;
        const count = densitySlider.value * 15;
        for (let i = 0; i < count; i++) {
            particles.push(new Particle(x, y, 0, color));
        }
    }

    function loop() {
        ctx.globalCompositeOperation = 'destination-out';
        ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalCompositeOperation = 'lighter';

        for (let i = particles.length - 1; i >= 0; i--) {
            particles[i].update();
            particles[i].draw();
            if (particles[i].alpha <= 0) particles.splice(i, 1);
        }
        requestAnimationFrame(loop);
    }

    loop();
</script>
</body>
</html>
